# 📦 DungeonStat 数据备份与恢复指南

## 🔄 自动备份机制

### 什么时候会自动备份？
- 每次应用启动时，如果检测到现有数据，会自动创建备份
- 备份文件存储在 UserDefaults 中，不会丢失

### 备份内容包括：
- ✅ 所有角色数据
- ✅ 所有副本数据  
- ✅ 所有完成记录
- ✅ 当前选中角色设置

## 🛠 手动备份与恢复

### 访问备份管理界面：
1. 打开应用
2. 进入 "角色管理" 页面
3. 点击右上角的备份图标 📦

### 创建手动备份：
1. 在备份管理页面点击 "创建新备份"
2. 系统会自动生成带时间戳的备份

### 恢复数据：
1. 在备份列表中找到要恢复的备份
2. 点击 "恢复" 按钮
3. 确认恢复操作
4. **⚠️ 警告：恢复会覆盖当前所有数据！**

## 🚨 紧急恢复步骤

### 如果数据出现问题：

#### 方法1：使用应用内恢复
1. 打开应用
2. 进入备份管理页面
3. 选择最近的备份进行恢复

#### 方法2：手动清除数据（重置）
如果应用无法正常启动：
1. 删除应用并重新安装
2. 应用会使用默认数据重新开始

## 📋 备份文件命名规则

```
原始键名 + _backup_ + 时间戳
例如：SavedDungeons_backup_1704336000
```

## 🔍 数据状态检查

在备份管理页面可以查看：
- 当前角色数量
- 当前副本数量  
- 完成记录数量
- 最后备份时间
- 详细的数据状态信息

## ⚡ 快速故障排除

### 问题：应用启动后数据丢失
**解决方案：**
1. 检查备份管理页面是否有可用备份
2. 选择最近的备份进行恢复
3. 如果没有备份，应用会使用默认数据

### 问题：恢复后数据不完整
**解决方案：**
1. 检查恢复的备份是否包含所有数据项
2. 尝试恢复更早的备份
3. 查看控制台日志了解具体错误

### 问题：无法创建备份
**解决方案：**
1. 确保有足够的存储空间
2. 重启应用再次尝试
3. 检查是否有有效数据需要备份

## 💡 最佳实践

1. **定期手动备份**：重要数据变更前先创建备份
2. **保留多个备份**：不要只依赖一个备份文件  
3. **测试恢复**：定期测试备份恢复功能
4. **关注日志**：出现问题时查看控制台输出

## 🔐 数据安全保障

- 备份数据存储在设备本地 UserDefaults 中
- 应用卸载会清除所有数据，建议定期导出重要数据
- 备份机制包含错误检测和恢复验证
- 恢复前会自动创建紧急备份以防万一

---

**注意：此备份系统设计用于应对代码重构等变更，确保用户数据不会因应用更新而丢失。**